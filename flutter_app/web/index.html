<!DOCTYPE html>
<html>

<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Spaced - Master any subject with intelligent spaced repetition">

  <!-- Google Sign-In -->
  <meta name="google-signin-client_id"
    content="605253712819-m9mmlqoi83tuplhslod2opj4f4cbgg23.apps.googleusercontent.com">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="spaced">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon using logo_purple.png -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <title>Spaced</title>
  <link rel="manifest" href="manifest.json">

  <!-- Material Design Icons with better fallback handling -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Primary Material Icons - load asynchronously for better performance -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=swap" rel="stylesheet">
  <!-- Additional variants can load asynchronously -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Two+Tone&display=swap" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Resource hints for faster loading -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link rel="preload" href="main.dart.js" as="script">
  <link rel="preload" href="flutter_bootstrap.js" as="script">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'ChironSungHK', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Ensure Material Icons load properly with comprehensive fallbacks */
    .material-icons {
      font-family: 'Material Icons', 'Material Icons Fallback', 'MaterialIcons-Regular', serif !important;
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-feature-settings: 'liga';
      font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      /* Ensure icons have a minimum size even if font fails */
      min-width: 24px;
      min-height: 24px;
    }

    /* Fallback for when Material Icons don't load */
    .material-icons:empty::before {
      content: "‚ö™";
      font-family: system-ui, sans-serif;
    }

    /* Force Flutter to use Material Icons for icon fonts */
    flt-material-icons {
      font-family: 'Material Icons', 'MaterialIcons-Regular' !important;
    }

    /* Flutter web specific icon fixes */
    flt-scene-host {
      --material-icons-font-family: 'Material Icons';
    }

    /* Fix for Flutter web canvas rendering */
    flt-glass-pane * {
      font-family: 'Material Icons', 'MaterialIcons-Regular' !important;
    }

    /* Specific fix for Flutter Icon widgets */
    flt-paragraph {
      font-family: 'Material Icons', 'MaterialIcons-Regular' !important;
    }

    /* Global icon font enforcement */
    [data-icon-font],
    .icon,
    .material-icons,
    i.material-icons {
      font-family: 'Material Icons', 'MaterialIcons-Regular', serif !important;
    }

    /* Ensure custom font loads properly */
    .chiron-font {
      font-family: 'ChironSungHK', serif;
    }

    /* Load ChironSungHK font for web */
    @font-face {
      font-family: 'ChironSungHK';
      src: url('fonts/chiron_sung_hk/ChironSungHK-Light.ttf') format('truetype');
      font-weight: 300;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'ChironSungHK';
      src: url('fonts/chiron_sung_hk/ChironSungHK-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'ChironSungHK';
      src: url('fonts/chiron_sung_hk/ChironSungHK-Medium.ttf') format('truetype');
      font-weight: 500;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'ChironSungHK';
      src: url('fonts/chiron_sung_hk/ChironSungHK-Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    /* Global font family with ChironSungHK as primary */
    * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .loading-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      background: #1E1E2E;
      color: #ffffff;
      font-family: 'ChironSungHK', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Auto-detect system theme */
    @media (prefers-color-scheme: light) {
      .loading-container {
        background: #8b5cf6;
        color: #ffffff;
      }
    }

    .logo-text {
      font-size: 3rem;
      font-weight: 700;
      font-family: 'ChironSungHK', serif;
      color: #ffffff;
      margin-bottom: 2rem;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #ffffff;
      animation: spin 1.2s linear infinite;
      margin-bottom: 2rem;
    }

    .motivational-text {
      font-size: 1.3rem;
      font-weight: 400;
      text-align: center;
      max-width: 450px;
      margin: 0 auto;
      line-height: 1.7;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      opacity: 0;
      animation: fadeInUp 0.8s ease-out forwards;
      font-family: 'ChironSungHK', serif;
    }

    .subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 1.5rem;
      font-weight: 300;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      font-family: 'ChironSungHK', serif;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }



    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>

  <!-- Fix for GitHub Pages 404 redirects -->
  <script type="text/javascript">
    // Single Page Apps for GitHub Pages
    // MIT License
    // https://github.com/rafgraph/spa-github-pages
    (function (l) {
      if (l.search[1] === '/') {
        var decoded = l.search.slice(1).split('&').map(function (s) {
          return s.replace(/~and~/g, '&')
        }).join('?');
        window.history.replaceState(null, null,
          l.pathname.slice(0, -1) + decoded + l.hash
        );
      }
    }(window.location))
  </script>

  <script>
    // The value below is injected by flutter build, do not touch.
    var serviceWorkerVersion = null;

    // Performance monitoring
    console.time('Flutter Initialization');
    window.addEventListener('flutter-first-frame', function () {
      console.timeEnd('Flutter Initialization');
      console.log('üöÄ Flutter app fully loaded');
    });

    // Monitor main.dart.js loading
    const script = document.createElement('script');
    script.src = 'main.dart.js';
    script.onload = () => console.log('üì¶ main.dart.js loaded');
    script.onerror = () => console.error('‚ùå main.dart.js failed to load');
  </script>

  <!-- Font loading diagnostic and fallback -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      console.log('üîç Checking font and asset loading...');

      // Check if Material Icons font is loading
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(function () {
          console.log('‚úÖ All fonts loaded successfully');
          // Force Material Icons font check
          document.fonts.load('24px "Material Icons"').then(function () {
            console.log('‚úÖ Material Icons font loaded successfully');
          }).catch(function (error) {
            console.warn('‚ö†Ô∏è Material Icons font failed to load:', error);
            // Add a backup class to body for CSS fallbacks
            document.body.classList.add('material-icons-fallback');
          });
        });
      }

      // Additional check for asset manifest
      fetch('/assets/AssetManifest.json').then(function (response) {
        if (response.ok) {
          console.log('‚úÖ AssetManifest.json loaded successfully');
          return response.json();
        } else {
          console.warn('‚ö†Ô∏è AssetManifest.json failed to load:', response.status);
          return null;
        }
      }).then(function (manifest) {
        if (manifest) {
          console.log('üì¶ Asset manifest contains', Object.keys(manifest).length, 'assets');
        }
      }).catch(function (error) {
        console.error('‚ùå AssetManifest.json request failed:', error);
      });

      // Check for Material Icons font file specifically
      fetch('/assets/fonts/MaterialIcons-Regular.otf').then(function (response) {
        if (response.ok) {
          console.log('‚úÖ MaterialIcons-Regular.otf loaded successfully');
        } else {
          console.warn('‚ö†Ô∏è MaterialIcons-Regular.otf failed to load:', response.status);
        }
      }).catch(function (error) {
        console.warn('‚ö†Ô∏è MaterialIcons-Regular.otf request failed:', error);
      });
    });
  </script>
</head>

<body>
  <!-- Themed Loading Screen -->
  <div id="loading" class="loading-container">
    <div class="logo-text">SPACED</div>
    <div class="loading-spinner"></div>
    <div class="motivational-text" id="motivational-text">
      Knowledge is power, but spaced repetition is the key to mastery.
    </div>
    <div class="subtitle">Loading your learning journey...</div>
  </div>

  <script>
    // Force path-based URL strategy
    window.addEventListener('load', function () {
      if (window.location.hash && window.location.hash.length > 1) {
        // Remove hash from URL and replace with path
        const hashPath = window.location.hash.substring(1);
        window.history.replaceState(null, null, hashPath);
      }
    });
  </script>

  <!-- Lazy-load the Flutter runtime after the page has rendered -->
  <script>
    (function () {
      function loadFlutter() {
        var s = document.createElement('script');
        s.src = 'main.dart.js';
        s.defer = true;
        document.body.appendChild(s);
      }
      if (document.readyState === 'complete') {
        loadFlutter();
      } else {
        window.addEventListener('load', loadFlutter);
      }
    })();
  </script>

  <script src="flutter_bootstrap.js" async></script>

  <script>
    // Motivational messages for the loading screen
    const motivationalMessages = [
      "Knowledge is power, but spaced repetition is the key to mastery.",
      "Every expert was once a beginner. Keep going!",
      "The best time to learn was yesterday. The second best time is now.",
      "Small progress is still progress. Celebrate every step forward.",
      "Your brain is like a muscle. Exercise it daily with spaced repetition.",
      "Learning is a journey, not a destination. Enjoy the process.",
      "Consistency beats perfection. Show up every day.",
      "The more you learn, the more you realize how much you don't know.",
      "Success is not final, failure is not fatal. It's the courage to continue that counts.",
      "Your future self is watching you right now through memories.",
      "The only way to do great work is to love what you learn.",
      "Learning is the only thing the mind never exhausts, never fears, and never regrets."
    ];

    let currentMessageIndex = 0;
    const motivationalText = document.getElementById('motivational-text');

    // Cycle through motivational messages every 3 seconds
    function cycleMessages() {
      if (motivationalText) {
        motivationalText.style.opacity = '0';
        setTimeout(() => {
          currentMessageIndex = (currentMessageIndex + 1) % motivationalMessages.length;
          motivationalText.textContent = motivationalMessages[currentMessageIndex];
          motivationalText.style.opacity = '1';
        }, 300);
      }
    }

    // Start cycling messages after initial load
    setTimeout(() => {
      setInterval(cycleMessages, 3000);
    }, 2000);

    // Hide loading screen when Flutter is ready
    window.addEventListener('flutter-first-frame', function () {
      const loading = document.querySelector('#loading');
      if (loading) {
        loading.style.opacity = '0';
        loading.style.transition = 'opacity 0.5s ease-out';
        setTimeout(() => {
          loading.remove();
        }, 500);
      }
    });
  </script>
</body>

</html>